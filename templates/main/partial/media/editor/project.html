<h4><i class="fa fa-film"></i> [[project.name]]</h4>

<div>
    <div class="tv-pattern" ng:show="!activeSegment">
        <div class="noise noise-1"></div>
        <div class="noise noise-2"></div>
    </div>

    <video-player autoplay="false" controls="false" connector="videoReady(connector, asset)" ng:repeat="(id, asset) in playedAssets" ng:show="activeSegment.asset.id == asset.id" width="840" height="440" />
</div>

<br/>

<div preloader data="project.id" text="Loading project">
    <div class="toolbar">
        <div class="dropdown pull-left">
            <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                <i class="fa fa-plus"></i> Add clip <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" style="width: 400px">
                <li ng:show="cutsBucket.cuts.length">
                    <div><input ng:model="filter" placeholder="Filter" class="form-control" autofocus /></div>
                </li>
                <li ng:repeat="cut in cutsBucket.cuts | filter:filter">
                    <a ng:click="addSegment(cut)" class="clearfix" href="#">
                        <span ng:click="cutsBucket.cuts.splice($index, 1)" class="btn btn-default btn-xs pull-right">
                            <i class="fa fa-trash-o"></i>
                        </span>
                        <div class="pull-left">
                            <img ng:src="/api/media/stream/[[cut.asset_id]]/thumb.jpeg" height="50" />
                            &nbsp;
                        </div>
                        <div class="pull-left">
                            <strong>[[cut.description || cut.asset_name]]</strong>
                            <br/>
                            <span>[[cut.t_in|time:cut.fps]] - [[cut.t_out|time:cut.fps]]</span>
                        </div>
                    </a>
                </li>
                <li ng:show="cutsBucket.cuts.length">
                    <a ng:click="addAllCuts()" href="#"><i class="fa fa-plus"></i> Add all</a>
                </li>
                <li ng:show="cutsBucket.cuts.length">
                    <a ng:click="removeAllCuts()" href="#"><i class="fa fa-trash-o"></i> Remove all</a>
                </li>
                <div ng:show="cutsBucket.cuts.length == 0" class="well">
                    No cuts created. Create some in the <a href="/media" target="_blank">Media library</a>.
                </div>
            </ul>
        </div>

        &nbsp;

        <div ng:click="splitHere()" class="btn btn-default">
            <i class="fa fa-scissors"></i> Split
        </div>

        &nbsp;

        <div class="btn-group">
            <div ng:click="zoomIn()" class="btn btn-default">
                <i class="fa fa-search-plus"></i>
            </div>
            <div ng:click="zoomOut()" class="btn btn-default">
                <i class="fa fa-search-minus"></i>
            </div>
        </div>

        &nbsp;

        <div class="btn-group">
            <div ng:click="seek(0)" class="btn btn-default">
                <i class="fa fa-fast-backward"></i>
            </div>
            <div ng:click="seekFrames(-5)" class="btn btn-default">
                <i class="fa fa-backward"></i>
            </div>
            <div ng:click="seekFrames(-1)" class="btn btn-default">
                <i class="fa fa-step-backward"></i>
            </div>
            <div ng:click="play()" class="btn btn-default" ng:hide="playing">
                <i class="fa fa-play"></i>
            </div>
            <div ng:click="pause()" class="btn btn-default" ng:show="playing">
                <i class="fa fa-pause"></i>
            </div>
            <div ng:click="seekFrames(+1)" class="btn btn-default">
                <i class="fa fa-step-forward"></i>
            </div>
            <div ng:click="seekFrames(+5)" class="btn btn-default">
                <i class="fa fa-forward"></i>
            </div>
            <div ng:click="seek(total_length)" class="btn btn-default">
                <i class="fa fa-fast-forward"></i>
            </div>
        </div>
        
        &nbsp;

        <code>[[currentTime|time]]</code>
        
        &nbsp;

        <div ng:click="rendererVisible = !rendererVisible" class="btn btn-default">
            <i class="fa fa-film"></i> Produce
        </div>
    </div>

    <div ng:show="rendererVisible">
        <br/>
        <div class="well">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 control-label">Output folder</label>
                    <div class="col-sm-10">
                        <elementspathselector absolute-path="project.output_path" />
                        <span ng:hide="renderDestinationAllowed" class="label label-warning"><i class="fa fa-warning"></i> Access to this path isn't alowed</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Leave tails</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input ng:model="renderParams.video.tails" type="number" class="form-control" />
                            <span class="input-group-addon">
                                seconds
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Produce a combined reel</label>
                    <div class="col-sm-2">
                        <span ng:model="renderParams.combine" class="form-control" checkbox text="Enable"></span>
                    </div>
                    <div class="col-sm-4" ng:show="renderParams.combine">
                        <select ng:model="renderParams.video.resolution" ng:options="x.value as x.name for x in knownVideoResolutions" class="form-control">
                        </select>
                    </div>
                    <div class="col-sm-2" ng:show="renderParams.combine">
                        <select ng:model="renderParams.video.fps" ng:options="x as x for x in knownVideoFramerates" class="form-control">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Render from</label>
                    <div class="col-sm-10">
                        <div class="btn-group">
                            <a ng:model="renderParams.data_source" class="btn btn-default" btn-radio="'original'">
                                <i class="fa fa-star"></i> Original files
                            </a>
                            <a ng:model="renderParams.data_source" class="btn btn-default" btn-radio="'proxy'">
                                <i class="fa fa-star-half-o"></i> Proxy files
                            </a>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <span ng:model="renderParams.wrap_opatom" class="form-control" checkbox text="Wrap into OP-Atom"></span>
                    </div>
                </div>
                <div class="form-group" ng:show="renderDestinationAllowed">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-10">
                        <a ng:click="render()" class="btn btn-primary">
                            <i class="fa fa-film"></i> Produce
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <br/>

    <div ng:show="activeSegment">
        <input ng:model="activeSegment.description" type="text" placeholder="Current clip description" class="form-control" />
    </div>

    <br/>


    <div class="sequence-editor">
        <div class="segments">
            <div class="segments-container" ng:style="{width: zoom * (total_length + 10) + 'px'}">
                <div class="timeline" ng:click="seekTimeline($event)">
                    <div class="timestamp" ng:repeat="timestamp in timestamps" bo:style="{width: timestamp_width_style}" bindonce bo:text="timestamp"></div>
                </div>
                <div ui:sortable="{tolerance: 'pointer'}" ng:model="project.segments">
                    <div class="segment" ng:repeat="segment in project.segments" ng:style="{width: zoom * (segment.t_out - segment.t_in) + 'px'}" ng:class="{active: segment == activeSegment}" ng:click="selectSegment(segment)" title="[[segment.description]]">
                        <div class="wrapper">
                            <video-thumbnail asset="segment.asset" time="segment.t_in" style="height:50px; float: left"></video-thumbnail>
                            <div>
                                <div>[[segment.asset.display_name]]</div>
                                <div><small>[[segment.t_in|time:segment.asset.info.fps]] - [[segment.t_out|time:segment.asset.info.fps]]</small></div>
                            </div>
                            <a ng:click="project.segments.splice($index, 1)" class="btn btn-default btn-xs pull-right remove">
                                <i class="fa fa-trash-o"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="time-indicator" ng:style="{left: zoom * currentTime + 'px'}"></div>
            </div>
        </div>
    </div>

    <br/>

    <div class="row">
        <div class="col-lg-8"></div>
        <div class="col-lg-4">
            <select ng:model="project.root" ng:options="x as x.name for x in roots track by x.id" class="form-control">
                <option value="">Show comments from a media root</option>
            </select>
        </div>
    </div>

    <table class="table" ng:show="project.segments.length">
        <tr>
            <th></th>
            <th></th>
            <th>Description</th>
            <th>Segment</th>
            <th></th>
        </tr>
        <tr ng:repeat="segment in project.segments">
            <td>
                <i class="fa fa-film"></i> <strong>[[$index + 1]]</strong>
                <br/>
                <div class="btn-group">
                    <a ng:click="swapSegments($index-1, $index)" ng:if="$index > 0" class="btn btn-default btn-xs">
                        <i class="fa fa-arrow-up"></i>
                    </a>
                    <a ng:click="swapSegments($index+1, $index)" ng:if="$index < project.segments.length - 1" class="btn btn-default btn-xs">
                        <i class="fa fa-arrow-down"></i>
                    </a>
                </div>
            </td>
            <td width="1">
                <img ng:src="/api/media/stream/[[segment.asset.id]]/thumb.jpeg" height="50" />
            </td>
            <td>
                <strong>[[segment.asset.display_name]]</strong>
                <input ng:model="segment.description" type="text" placeholder="Description" class="form-control" />
                <div ng:show="assetEntries[segment.asset.id]">
                    <div class="well">
                        <div ng:repeat="comment in assetEntries[segment.asset.id].comments | orderBy:'-date'">
                            <strong>[[comment.user.username]]</strong>: [[comment.text]]
                            <span ng:show="comment.time"> ([[comment.time | time:segment.asset.info.fps]])</span>
                        </div>
                    </div>
                </div>
            </td>
            <td>
                <span>[[segment.t_in|time:segment.asset.info.fps]] - [[segment.t_out|time:segment.asset.info.fps]]</span>
            </td>
            <td width="1">
                <a class="btn btn-default btn-sm" ng:click="removeSegment(segment)"><i class="fa fa-trash-o"></i> Remove</a>
            </td>
        </tr>
    </table>

    <div class="sticky-panel">
        <a ng:click="save()" class="btn btn-primary">
            <i class="fa fa-check"></i>
            Save
        </a>
        <a ng:click="delete()" class="btn btn-default">
            <i class="fa fa-trash-o"></i>
            Delete
        </a>
    </div>
</div>
