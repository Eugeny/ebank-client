<filterbox ng:model="filter" />

<br/>

<div class="list-group">
    <a href="/user/[[user.id]]" class="slide list-group-item" ng:repeat="user in users | filter:filter | orderBy:'username'">
        <div>
            <i class="fa fa-user"></i> [[user.username]]
        </div>
        <div ng:show="user.last_seen">
            <span class="label label-info">Online</span> 
            <small>last seen on [[user.last_seen | date:"short"]]</small>
            <div ng:repeat="activity in activities">
                <div ng:if="activity.user == user.resource_uri">
                    <span class="label label-info">Connected</span> 
                    <b>[[activity.workspace.name]]</b>
                    <small>since [[activity.date | date:"shortTime"]]</small>
                </div>
            </div>
        </div>
    </a>
</div>

<div class="form-group">
    <input ng:enter="create(newUsername)" type="text" required class="form-control" placeholder="New user name" ng:model="newUsername" />
</div>
<div class="form-group">
    <a ng:click="create(newUsername)" class="btn btn-primary">
        <i class="fa fa-plus"></i>
        Create user
    </a>
</div>


<h3>One-time access tokens</h3>

<div class="list-group">
    <div class="slide list-group-item" ng:repeat="token in tokens">
        <div>
            <a ng:click="deleteToken(token)" class="btn btn-danger btn-ink btn-xs pull-right"><i class="fa fa-trash-o"></i> Revoke</a>
            <i class="fa fa-key"></i> [[ system.external_url || ($location.protocol() + '://' + $location.host() + ":" + $location.port()) ]]/auth/fast-lane/[[token.token]]
            &nbsp;
            <i class="fa fa-arrow-right"></i>
            &nbsp;
            [[token.url]]
        </div>
        <div>
            Created by <i class="fa fa-user"></i> [[token.created_by.username]]
        </div>
        <div ng:repeat="activity in token.activity">
            <div>
                <span class="label label-info"><i class="fa fa-globe"></i> [[activity.ip]]</span> 
                <small>on [[activity.date | date:"medium"]]</small>
            </div>
        </div>
    </div>
</div>

<br/>

<div class="form-group">
    <label class="col-sm-2 control-label">New token URL</label>
    <div class="col-sm-10">
        <input type="text" required class="form-control" ng:model="newToken.url" />
        <small class="help-text">
            Starts with '/'
        </small>
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">Views</label>
    <div class="col-sm-2">
        <span ng:model="newToken.view_limit_enabled" class="form-control" checkbox text="Limit"></span>
    </div>
    <div class="col-sm-8" ng:show="newToken.view_limit_enabled">
        <input type="number" class="form-control" ng:model="newToken.view_limit_left" />
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">Expires</label>
    <div class="col-sm-10">
        <input type="text" class="form-control" datepicker-popup="dd-MMMM-yyyy" ng:model="newToken.expires" is-open="dpOpened" ng:click="dpOpened=true" close-text="Close" />
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label"></label>
    <div class="col-sm-10">
        <a ng:click="createToken()" class="btn btn-primary">
            <i class="fa fa-check"></i>
            Create token
        </a>
    </div>
</div>
